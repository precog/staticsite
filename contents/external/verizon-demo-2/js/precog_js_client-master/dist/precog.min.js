/*! precog 2013-05-06 */
(function(e){if("function"==typeof bootstrap)bootstrap("precog",e);else if("object"==typeof exports)module.exports=e();else if("function"==typeof define)define(e);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makePrecog=e}else window.Precog=e()})(function(){function PrecogHttp(e){return PrecogHttp.http(e)}function Precog(e){return this instanceof Precog?(this.config=e,void 0):new Precog(e)}if(function(){var e="undefined"!=typeof window?window:exports,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r=function(){try{document.createElement("$")}catch(e){return e}}();e.btoa||(e.btoa=function(e){for(var n,i,a=0,o=t,s="";e.charAt(0|a)||(o="=",a%1);s+=o.charAt(63&n>>8-8*(a%1))){if(i=e.charCodeAt(a+=.75),i>255)throw r;n=n<<8|i}return s}),e.atob||(e.atob=function(e){if(e=e.replace(/=+$/,""),1==e.length%4)throw r;for(var n,i,a=0,o=0,s="";i=e.charAt(o++);~i&&(n=a%4?64*n+i:i,a++%4)?s+=String.fromCharCode(255&n>>(6&-2*a)):0)i=t.indexOf(i);return s})}(),"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(e){return 10>e?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var r,n,i,a,o,s=gap,u=t[e];switch(u&&"object"==typeof u&&"function"==typeof u.toJSON&&(u=u.toJSON(e)),"function"==typeof rep&&(u=rep.call(t,e,u)),typeof u){case"string":return quote(u);case"number":return isFinite(u)?u+"":"null";case"boolean":case"null":return u+"";case"object":if(!u)return"null";if(gap+=indent,o=[],"[object Array]"===Object.prototype.toString.apply(u)){for(a=u.length,r=0;a>r;r+=1)o[r]=str(r,u)||"null";return i=0===o.length?"[]":gap?"[\n"+gap+o.join(",\n"+gap)+"\n"+s+"]":"["+o.join(",")+"]",gap=s,i}if(rep&&"object"==typeof rep)for(a=rep.length,r=0;a>r;r+=1)"string"==typeof rep[r]&&(n=rep[r],i=str(n,u),i&&o.push(quote(n)+(gap?": ":":")+i));else for(n in u)Object.prototype.hasOwnProperty.call(u,n)&&(i=str(n,u),i&&o.push(quote(n)+(gap?": ":":")+i));return i=0===o.length?"{}":gap?"{\n"+gap+o.join(",\n"+gap)+"\n"+s+"}":"{"+o.join(",")+"}",gap=s,i}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,r){var n;if(gap="",indent="","number"==typeof r)for(n=0;r>n;n+=1)indent+=" ";else"string"==typeof r&&(indent=r);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw Error("JSON.stringify");return str("",{"":e})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var r,n,i=e[t];if(i&&"object"==typeof i)for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(n=walk(i,r),void 0!==n?i[r]=n:delete i[r]);return reviver.call(e,t,i)}var j;if(text+="",cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),"undefined"!=typeof window)"undefined"==typeof sessionStorage&&function(e){function t(){function t(){l.cookie=["sessionStorage="+e.encodeURIComponent(o=i.key(128))].join(";"),s=i.encode(o,s),a=new a(r,"name",r.name)}var n,l=(r.name,r.document),p=/\bsessionStorage\b=([^;]+)(;|$)/,f=p.exec(l.cookie);if(f){o=e.decodeURIComponent(f[1]),s=i.encode(o,s),a=new a(r,"name");for(var d=a.key(),n=0,h=d.length,y={};h>n;++n)0===(f=d[n]).indexOf(s)&&(u.push(f),y[f]=a.get(f),a.del(f));if(a=new a.constructor(r,"name",r.name),(this.length=u.length)>0){for(n=0,h=u.length,c=a.c,f=[];h>n;++n)f[n]=c.concat(a._c,a.escape(d=u[n]),c,c,(d=a.escape(y[d])).length,c,d);r.name+=f.join("")}}else t(),p.exec(l.cookie)||(u=null)}var r=e;try{for(;r!==r.top;)r=r.top}catch(n){}var i=function(e,t){return{decode:function(e,t){return this.encode(e,t)},encode:function(t,r){for(var n,i=t.length,a=r.length,o=[],s=[],u=0,c=0,l=0,p=0;256>u;++u)s[u]=u;for(u=0;256>u;++u)c=(c+(n=s[u])+t.charCodeAt(u%i))%256,s[u]=s[c],s[c]=n;for(c=0;a>l;++l)u=l%256,c=(c+(n=s[u]))%256,i=s[u]=s[c],s[c]=n,o[p++]=e(r.charCodeAt(l)^s[(i+n)%256]);return o.join("")},key:function(r){for(var n=0,i=[];r>n;++n)i[n]=e(1+(255*t()<<0));return i.join("")}}}(e.String.fromCharCode,e.Math.random),a=function(e){function t(e,t,r){this._i=(this._data=r||"").length,(this._key=t)?this._storage=e:(this._storage={_key:e||""},this._key="_key")}function r(e,t){var r=this.c;return r.concat(this._c,this.escape(e),r,r,(t=this.escape(t)).length,r,t)}return t.prototype.c=String.fromCharCode(1),t.prototype._c=".",t.prototype.clear=function(){this._storage[this._key]=this._data},t.prototype.del=function(e){var t=this.get(e);null!==t&&(this._storage[this._key]=this._storage[this._key].replace(r.call(this,e,t),""))},t.prototype.escape=e.escape,t.prototype.get=function(e){var t=this._storage[this._key],r=this.c,n=t.indexOf(e=r.concat(this._c,this.escape(e),r,r),this._i),i=null;return n>-1&&(n=t.indexOf(r,n+e.length-1)+1,i=t.substring(n,n=t.indexOf(r,n)),i=this.unescape(t.substr(++n,i))),i},t.prototype.key=function(){for(var e=this._storage[this._key],t=this.c,r=t+this._c,n=this._i,i=[],a=0,o=0;(n=e.indexOf(r,n))>-1;)i[o++]=this.unescape(e.substring(n+=2,a=e.indexOf(t,n))),n=e.indexOf(t,a)+2,a=e.indexOf(t,n),n=1+a+1*e.substring(n,a);return i},t.prototype.set=function(e,t){this.del(e),this._storage[this._key]+=r.call(this,e,t)},t.prototype.unescape=e.unescape,t}(e);"[object Opera]"===Object.prototype.toString.call(e.opera)&&(history.navigationMode="compatible",a.prototype.escape=e.encodeURIComponent,a.prototype.unescape=e.decodeURIComponent),t.prototype={length:0,key:function(e){if("number"!=typeof e||0>e||e>=u.length)throw"Invalid argument";return u[e]},getItem:function(e){if(e=s+e,p.call(l,e))return l[e];var t=a.get(e);return null!==t&&(t=l[e]=i.decode(o,t)),t},setItem:function(e,t){this.removeItem(e),e=s+e,a.set(e,i.encode(o,l[e]=""+t)),this.length=u.push(e)},removeItem:function(e){var t=a.get(e=s+e);null!==t&&(delete l[e],a.del(e),this.length=u.remove(e))},clear:function(){a.clear(),l={},u.length=0}};var o,s=r.document.domain,u=[],l={},p=l.hasOwnProperty;u.remove=function(e){var t=this.indexOf(e);return t>-1&&this.splice(t,1),this.length},u.indexOf||(u.indexOf=function(e){for(var t=0,r=this.length;r>t;++t)if(this[t]===e)return t;return-1}),r.sessionStorage&&(t=function(){},t.prototype=r.sessionStorage),t=new t,null!==u&&(e.sessionStorage=t)}(window);else{var storage={};localStorage={setItem:function(e,t){storage[e]=t},getItem:function(e){return storage[e]},removeItem:function(e){delete storage[e]}}}return function(e){var t=function(e){this._res=e,this._isFulfilled=!!arguments.length,this._isRejected=!1,this._fulfilledCallbacks=[],this._rejectedCallbacks=[],this._progressCallbacks=[]};t.prototype={valueOf:function(){return this._res},isFulfilled:function(){return this._isFulfilled},isRejected:function(){return this._isRejected},isResolved:function(){return this._isFulfilled||this._isRejected},fulfill:function(e){this.isResolved()||(this._isFulfilled=!0,this._res=e,this._callCallbacks(this._fulfilledCallbacks,e),this._fulfilledCallbacks=this._rejectedCallbacks=this._progressCallbacks=r)},reject:function(e){this.isResolved()||(this._isRejected=!0,this._res=e,this._callCallbacks(this._rejectedCallbacks,e),this._fulfilledCallbacks=this._rejectedCallbacks=this._progressCallbacks=r)},notify:function(e){this.isResolved()||this._callCallbacks(this._progressCallbacks,e)},then:function(e,r,n){var i,a=new t;return this._isRejected||(i={promise:a,fn:e},this._isFulfilled?this._callCallbacks([i],this._res):this._fulfilledCallbacks.push(i)),this._isFulfilled||(i={promise:a,fn:r},this._isRejected?this._callCallbacks([i],this._res):this._rejectedCallbacks.push(i)),this.isResolved()||this._progressCallbacks.push({promise:a,fn:n}),a},fail:function(e){return this.then(r,e)},always:function(e){var t=this,r=function(){return e(t)};return this.then(r,r)},progress:function(e){return this.then(r,r,e)},spread:function(e,t){return this.then(function(t){return e.apply(this,t)},t)},done:function(){this.fail(a)},delay:function(e){return this.then(function(r){var n=new t;return setTimeout(function(){n.fulfill(r)},e),n})},timeout:function(e){var r=new t,n=setTimeout(function(){r.reject(Error("timed out"))},e);return r.sync(this),r.always(function(){clearTimeout(n)}),r},sync:function(e){var t=this;e.then(function(e){t.fulfill(e)},function(e){t.reject(e)})},_callCallbacks:function(e,t){var r=e.length;if(r){var a=this.isResolved(),s=this.isFulfilled();i(function(){for(var i,u,c,l=0;r>l;)if(i=e[l++],u=i.promise,c=i.fn,o(c)){var p;p=c(t),a?n.isPromise(p)?function(e){p.then(function(t){e.fulfill(t)},function(t){e.reject(t)})}(u):u.fulfill(p):u.notify(p)}else a?s?u.fulfill(t):u.reject(t):u.notify(t)})}}};var r,n={promise:function(e){return arguments.length?this.isPromise(e)?e:new t(e):new t},when:function(e,t,r,n){return this.promise(e).then(t,r,n)},fail:function(e,t){return this.when(e,r,t)},always:function(e,t){return this.promise(e).always(t)},progress:function(e,t){return this.promise(e).progress(t)},spread:function(e,t,r){return this.promise(e).spread(t,r)},done:function(e){this.isPromise(e)&&e.done()},isPromise:function(e){return e&&o(e.then)},valueOf:function(e){return this.isPromise(e)?e.valueOf():e},isFulfilled:function(e){return this.isPromise(e)?e.isFulfilled():!0},isRejected:function(e){return this.isPromise(e)?e.isRejected():!1},isResolved:function(e){return this.isPromise(e)?e.isResolved():!0},fulfill:function(e){return this.when(e,r,function(e){return e})},reject:function(e){return this.when(e,function(e){var r=new t;return r.reject(e),r})},resolve:function(e){return this.isPromise(e)?e:this.when(e)},invoke:function(e){return this.promise(e.apply(null,s.call(arguments,1)))},forEach:function(e,t,r,n){for(var i=n?n.length:e.length,a=0;i>a;)this.when(e[n?n[a]:a],t,r),++a},all:function(e){var r=new t,i=c(e),a=i?l(e):p(e),o=a.length,s=i?[]:{};if(!o)return r.fulfill(s),r;var u=o,f=function(){if(!--u){for(var t=0;o>t;)s[a[t]]=n.valueOf(e[a[t++]]);r.fulfill(s)}},d=function(e){r.reject(e)};return this.forEach(e,f,d,a),r},allResolved:function(e){var r=new t,n=c(e),i=n?l(e):p(e),a=i.length,o=n?[]:{};if(!a)return r.fulfill(o),r;var s=function(){--a||r.fulfill(e)};return this.forEach(e,s,s,i),r},any:function(e){var r=new t,n=e.length;if(!n)return r.reject(Error()),r;var i,a=0,o=function(e){r.fulfill(e)},s=function(e){a||(i=e),++a===n&&r.reject(i)};return this.forEach(e,o,s),r},delay:function(e,t){return this.promise(e).delay(t)},timeout:function(e,t){return this.promise(e).timeout(t)}},i=function(){if("object"==typeof process)return process.nextTick;if(e.setImmediate)return e.setImmediate;var t=[],r=function(){var e=t,r=0,n=t.length;for(t=[];n>r;)e[r++]()};if(e.postMessage){var n=!0;if(e.attachEvent){var i=function(){n=!1};e.attachEvent("onmessage",i),e.postMessage("__checkAsync","*"),e.detachEvent("onmessage",i)}if(n){var a="__promise"+ +new Date,o=function(e){e.data===a&&(e.stopPropagation&&e.stopPropagation(),r())};return e.addEventListener?e.addEventListener("message",o,!0):e.attachEvent("onmessage",o),function(r){1===t.push(r)&&e.postMessage(a,"*")}}}var s=e.document;if("onreadystatechange"in s.createElement("script")){var u=function(){var e=s.createElement("script");e.onreadystatechange=function(){e.parentNode.removeChild(e),e=e.onreadystatechange=null,r()},(s.documentElement||s.body).appendChild(e)};return function(e){1===t.push(e)&&u()}}return function(e){setTimeout(e,0)}}(),a=function(e){i(function(){throw e})},o=function(e){return"function"==typeof e},s=Array.prototype.slice,u=Object.prototype.toString,c=Array.isArray||function(e){return"[object Array]"===u.call(e)},l=function(e){for(var t=[],r=0,n=e.length;n>r;)t.push(r++);return t},p=Object.keys||function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(r);return t};"object"==typeof exports?module.exports=n:"object"==typeof modules?modules.define("vow",function(e){e(n)}):"function"==typeof define?define(function(e,t,r){r.exports=n}):e.Vow=n}(this),"undefined"==typeof window&&(Vow=module.exports),function(e){var t={};t.makeBaseAuth=function(e,t){return"Basic "+("undefined"!=typeof btoa?btoa:exports.btoa)(e+":"+t)},t.addQuery=function(e,t){var r=e.lastIndexOf("#"),n="";r>=0&&(n="#"+e.substr(r+1),e=e.substr(0,r));var i=-1==e.indexOf("?")?"?":"&",a=[];for(var o in t)if(null!=t[o]){var s=""+t[o];s.length>0&&a.push(encodeURIComponent(o)+"="+encodeURIComponent(s))}return 0===a.length?e+n:e+i+a.join("&")+n},t.parseResponseHeaders=function(e){var r={};if(e.getAllResponseHeaders)for(var n=e.getAllResponseHeaders().split(/\r?\n/),i=0;n.length>i;i++)if(n[i]){var a=n[i],o=a.indexOf(":"),s=t.strtrim(a.substr(0,o)),u=t.strtrim(a.substr(o+1));r[s]=u}if(0===t.objsize(r)&&e.getResponseHeader){var c=e.getResponseHeader("Content-Type");c&&(r["Content-Type"]=c)}return r},t.defopts=function(e){var r=function(e,t){return function(r){if("undefined"!=typeof console){var n=console[e]||console.info;n.call(console,t.method+" "+t.url),n.call(console,r)}return"error"!==e?r:void 0}};return function(n){var i={};return i.method=n.method||"GET",i.url=t.addQuery(n.url,n.query),i.content=n.content,i.headers=n.headers||{},i.success=n.success||r("debug",i),i.failure=n.failure||r("error",i),i.progress=n.progress||r("debug",i),i.sync=n.sync||!1,n.basicAuth&&(i.headers.Authorization=t.makeBaseAuth(n.basicAuth.username,n.basicAuth.password)),e(i)}},t.responseCallback=function(e,t,r){e.status>=200&&300>e.status?t(e):r(e)},t.strtrim=function(e){return e.replace(/^\s+|\s+$/g,"")},t.objsize=function(e){var t=0;for(var r in e)e.hasOwnProperty(r)&&t++;return t},t.merge=function(e,t){var r,n={};for(r in e)n[r]=e[r];for(r in t)n[r]=t[r];return n},e.createAjax=function(){return window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")},e.http=function(t){return"undefined"==typeof window?e.nodejs(t):"withCredentials"in e.createAjax()?e.ajax(t):e.jsonp(t)},e.ajax=t.defopts(function(r){var n=Vow.promise(),i=e.createAjax();i.open(r.method,r.url,r.sync),i.upload&&(i.upload.onprogress=function(e){e.lengthComputable&&r.progress({loaded:e.loaded,total:e.total})}),i.onreadystatechange=function(){var e=t.parseResponseHeaders(i);if(4===i.readyState){var r=this.responseText;if(null!=r)try{var a=e["Content-Type"];("application/json"==a||"text/json"==a)&&(r=JSON.parse(this.responseText))}catch(o){}t.responseCallback({headers:e,content:r,status:i.status,statusText:i.statusText},function(e){n.fulfill(e)},function(e){n.reject(e)})}};for(var a in r.headers){var o=r.headers[a];i.setRequestHeader(a,o)}return void 0!==r.content?r.headers["Content-Type"]?i.send(r.content):(i.setRequestHeader("Content-Type","application/json"),i.send(JSON.stringify(r.content))):i.send(null),n.then(r.success,r.failure)}),e.jsonp=t.defopts(function(e){var r=Math.floor(214748363*Math.random()),n="PrecogJsonpCallback"+(""+r),i=Vow.promise();window[n]=function(e,r){t.responseCallback({headers:r.headers,content:e,status:r.status.code,statusText:r.status.reason},function(e){i.fulfill(e)},function(e){i.reject(e)}),document.head.removeChild(document.getElementById(n));try{delete window[n]}catch(a){window[n]=void 0}};var a={method:e.method,callback:n};e.headers&&t.objsize(e.headers)>0&&(a.headers=JSON.stringify(e.headers)),void 0!==e.content&&(a.content=JSON.stringify(e.content));var o=document.createElement("SCRIPT");return o.addEventListener&&o.addEventListener("error",function(t){e.failure({headers:{},content:void 0,statusText:t.message||"Failed to load script from server",statusCode:400})},!0),o.setAttribute("type","text/javascript"),o.setAttribute("src",t.addQuery(e.url,a)),o.setAttribute("id",n),document.head||(document.head=document.getElementsByTagName("head")[0]),document.head.appendChild(o),i.then(e.success,e.failure)}),e.nodejs=t.defopts(function(e){var r=require("url").parse(e.url),n=require("https:"==r.protocol?"https":"http"),i=Vow.promise();r.method=e.method,r.headers=e.headers,e.content&&!e.headers["Content-Type"]&&(r.headers["Content-Type"]="application/json");var a=n.request(r,function(r){var n="";r.setEncoding("utf8"),r.on("data",function(t){n+=t,r.headers["content-length"]&&e.progress({loaded:n.length,total:r.headers["content-length"]})}),r.on("end",function(){var e=n,a=r.headers["content-type"];if(e&&("application/json"==a||"text/json"==a))try{e=JSON.parse(e)}catch(o){}t.responseCallback({headers:r.headers,content:e,status:r.statusCode,statusText:require("http").STATUS_CODES[r.statusCode]},function(e){i.fulfill(e)},function(e){i.reject(e)})})});return e.content&&a.write(e.headers["Content-Type"]&&"string"!=typeof e.content?JSON.stringify(e.content):e.content),a.end(),i.then(e.success,e.failure)}),e.get=function(r){return e.http(t.merge(r,{method:"GET"}))},e.put=function(r){return e.http(t.merge(r,{method:"PUT"}))},e.post=function(r){return e.http(t.merge(r,{method:"POST"}))},e.delete0=function(r){return e.http(t.merge(r,{method:"DELETE"}))},e.patch=function(r){return e.http(t.merge(r,{method:"PATCH"}))}}(PrecogHttp),function(e){var t={};t.error=function(e){throw"undefined"!=typeof console&&console.error(e),Error(e)},t.amap=function(e,t){for(var r=[],n=0;e.length>n;n++)r.push(t(e[n]));return r},t.acontains=function(e,t){for(var r=0;e.length>r;r++)if(e[r]==t)return!0;return!1},t.requireParam=function(e,r){null==e&&t.error('The parameter "'+r+'" may not be null or undefined')},t.requireField=function(e,r){(null==e||null==e[r])&&t.error('The field "'+r+'" may not be null or undefined')},t.removeTrailingSlash=function(e){return null==e||0===e.length?e:"/"==e.substr(e.length-1)?e.substr(0,e.length-1):e},t.composef=function(e,t){return e?t?function(r){return e(t(r))}:e:t},t.parentPath=function(e){var r=t.removeTrailingSlash(t.sanitizePath(e)),n=r.split("/"),i=n.slice(0,n.length-1);return i.length?i.join("/"):"/"},t.lastPathElement=function(e){var r=t.sanitizePath(e),n=r.split("/");return 0===n.length?void 0:n[n.length-1]},t.extractField=function(e){return function(t){return t[e]}},t.extractContent=t.extractField("content"),t.safeCallback=function(e){return null==e?function(e){return e}:function(t){var r=e(t);return void 0===r?t:r}},t.sanitizePath=function(e){return e.replace(/\/+/g,"/")},t.merge=function(e,r){var n,i,a;if(void 0===e)return e;if(void 0===r)return e;if(e instanceof Array&&r instanceof Array){for(n=[],a=0;e.length>a;a++)n.push(e[a]);for(a=0;r.length>a;a++)n.length>a?n[a]=t.merge(n[a],r[a]):n.push(r[a]);return n}if(e instanceof Object&&r instanceof Object){n={};for(i in e)n[i]=e[i];for(i in r)n[i]=void 0!==n[i]?t.merge(n[i],r[i]):r[i];return n}return r},t.addCallbacks=function(e){return function(r,n,i){return e.call(this,r).then(t.safeCallback(n),i)}},e.prototype.serviceUrl=function(e,r,n){return t.requireField(this.config,"analyticsService"),this.config.analyticsService+t.sanitizePath("/"+e+"/v"+r+"/"+(n||""))},e.prototype.accountsUrl=function(e){return this.serviceUrl("accounts",1,e)},e.prototype.securityUrl=function(e){return this.serviceUrl("security",1,e)},e.prototype.dataUrl=function(e){return this.serviceUrl("ingest",1,e)},e.prototype.analysisUrl=function(e){return this.serviceUrl("analytics",1,e)},e.prototype.metadataUrl=function(e){return this.serviceUrl("meta",1,e)},e.prototype.requireConfig=function(e){(null==this.config||null==this.config[e])&&t.error('The configuration field "'+e+'" may not be null or undefined')},e.GrantTypes={Append:"append",Replace:"replace",Execute:"execute",Mount:"mount",Create:"create",Explore:"explore"},e.FileTypes={JSON:"application/json",JSON_STREAM:"application/x-json-stream",CSV:"text/csv",ZIP:"application/zip",GZIP:"application/x-gzip",QUIRREL_SCRIPT:"text/x-quirrel-script"},e.prototype.createAccount=t.addCallbacks(function(e){var r=this;return t.requireField(e,"email"),t.requireField(e,"password"),PrecogHttp.post({url:r.accountsUrl("accounts/"),content:e,success:t.extractContent})}),e.prototype.requestPasswordReset=t.addCallbacks(function(e){var r=this;return t.requireParam(e,"email"),r.lookupAccountId(e).then(function(n){return PrecogHttp.post({url:r.accountsUrl("accounts")+"/"+n.accountId+"/password/reset",content:{email:e},success:t.extractContent})})}),e.prototype.lookupAccountId=t.addCallbacks(function(e){var r=this,n=Vow.promise();return t.requireParam(e,"email"),PrecogHttp.get({url:r.accountsUrl("accounts/search"),query:{email:e},success:function(e){var t=e.content;t&&0!==t.length?n.fulfill(t[0]):n.reject({status:400,statusText:"No account ID found for given email"})},failure:n.reject}),n}),e.prototype.describeAccount=t.addCallbacks(function(e){var r=this;return t.requireField(e,"email"),t.requireField(e,"password"),r.lookupAccountId(e.email).then(function(n){return PrecogHttp.get({basicAuth:{username:e.email,password:e.password},url:r.accountsUrl("accounts/"+n.accountId),success:t.extractContent})})}),e.prototype.addGrantToAccount=t.addCallbacks(function(e){var r=this;return t.requireField(e,"accountId"),t.requireField(e,"grantId"),PrecogHttp.post({url:r.accountsUrl("accounts/"+e.accountId+"/grants/"),content:{grantId:e.grantId},success:t.extractContent})}),e.prototype.currentPlan=t.addCallbacks(function(e){var r=this;return t.requireField(e,"email"),t.requireField(e,"password"),r.lookupAccountId(e.email).then(function(n){return PrecogHttp.get({basicAuth:{username:e.email,password:e.password},url:r.accountsUrl("accounts/"+n.accountId+"/plan"),success:t.composef(t.extractField("type"),t.extractContent)})})}),e.prototype.changePlan=t.addCallbacks(function(e){var r=this;return t.requireField(e,"email"),t.requireField(e,"password"),t.requireField(e,"plan"),r.lookupAccountId(e.email).then(function(n){return PrecogHttp.put({basicAuth:{username:e.email,password:e.password},url:r.accountsUrl("accounts/"+n.accountId+"/plan"),content:{type:e.plan},success:t.extractContent})})}),e.prototype.deletePlan=t.addCallbacks(function(e){var r=this;return t.requireField(e,"email"),t.requireField(e,"password"),r.lookupAccountId(e.email).then(function(n){return PrecogHttp.delete0({basicAuth:{username:e.email,password:e.password},url:r.accountsUrl("accounts/"+n.accountId+"/plan"),success:t.composef(t.extractField("type"),t.extractContent)})})}),e.prototype.listApiKeys=function(e,r){var n=this;return n.requireConfig("apiKey"),PrecogHttp.get({url:n.securityUrl("apikeys/"),query:{apiKey:n.config.apiKey},success:t.extractContent}).then(t.safeCallback(e),r)},e.prototype.createApiKey=t.addCallbacks(function(e){var r=this;return t.requireParam(e,"grants"),r.requireConfig("apiKey"),PrecogHttp.post({url:r.securityUrl("apikeys/"),content:e,query:{apiKey:r.config.apiKey},success:t.extractContent})}),e.prototype.describeApiKey=t.addCallbacks(function(e){var r=this;return r.requireConfig("apiKey"),PrecogHttp.get({url:r.securityUrl("apikeys/"+e),query:{apiKey:r.config.apiKey},success:t.extractContent})}),e.prototype.deleteApiKey=t.addCallbacks(function(e){var r=this;return t.requireParam(e,"apiKey"),r.requireConfig("apiKey"),PrecogHttp.delete0({url:r.securityUrl("apikeys/"+e),query:{apiKey:r.config.apiKey},success:t.extractContent})}),e.prototype.retrieveApiKeyGrants=t.addCallbacks(function(e){var r=this;return t.requireParam(e,"apiKey"),r.requireConfig("apiKey"),PrecogHttp.get({url:r.securityUrl("apikeys/"+e+"/grants/"),query:{apiKey:r.config.apiKey},success:t.extractContent})}),e.prototype.addGrantToApiKey=t.addCallbacks(function(e){var r=this;return t.requireField(e,"grant"),t.requireField(e,"apiKey"),r.requireConfig("apiKey"),PrecogHttp.post({url:r.securityUrl("apikeys/"+e.apiKey+"/grants/"),content:e.grant,query:{apiKey:r.config.apiKey},success:t.extractContent})}),e.prototype.removeGrantFromApiKey=t.addCallbacks(function(e){var r=this;return t.requireField(e,"grantId"),t.requireField(e,"apiKey"),r.requireConfig("apiKey"),PrecogHttp.delete0({url:r.securityUrl("apikeys/"+e.apiKey+"/grants/"+e.grantId),query:{apiKey:r.config.apiKey},success:t.extractContent})}),e.prototype.createGrant=t.addCallbacks(function(e){var r=this;return t.requireParam(e,"grant"),r.requireConfig("apiKey"),PrecogHttp.post({url:r.securityUrl("grants/"),content:e,query:{apiKey:r.config.apiKey},success:t.extractContent})}),e.prototype.describeGrant=t.addCallbacks(function(e){var r=this;return t.requireParam(e,"grantId"),r.requireConfig("apiKey"),PrecogHttp.get({url:r.securityUrl("grants/"+e),query:{apiKey:r.config.apiKey},success:t.extractContent})}),e.prototype.deleteGrant=t.addCallbacks(function(e){var r=this;return t.requireParam(e,"grantId"),r.requireConfig("apiKey"),PrecogHttp.delete0({url:r.securityUrl("grants/"+e),query:{apiKey:r.config.apiKey},success:t.extractContent})}),e.prototype.listGrantChildren=t.addCallbacks(function(e){var r=this;return t.requireParam(e,"grantId"),r.requireConfig("apiKey"),PrecogHttp.get({url:r.securityUrl("grants/"+e+"/children/"),query:{apiKey:r.config.apiKey},success:t.extractContent})}),e.prototype.createGrantChild=t.addCallbacks(function(e){var r=this;return t.requireField(e,"parentGrantId"),t.requireField(e,"childGrant"),r.requireConfig("apiKey"),PrecogHttp.post({url:r.securityUrl("grants/"+e.parentGrantId+"/children/"),content:e.childGrant,query:{apiKey:r.config.apiKey},success:t.extractContent})}),e.prototype._retrieveMetadata=t.addCallbacks(function(e){var r=this;return t.requireParam(e,"path"),r.requireConfig("apiKey"),PrecogHttp.get({url:r.metadataUrl("fs/"+e),query:{apiKey:r.config.apiKey},success:t.extractContent})}),e.prototype._uniqueHash=function(){var e=this,t=function(e){var t=0;if(0===e.length)return t;for(var r=0;e.length>r;r++){var n=e.charCodeAt(r);t=(t<<5)-t+n,t&=t}return t};return e.requireConfig("apiKey"),t("Precog"+e.config.apiKey)},e.prototype._localStorageKey=function(e){return this._uniqueHash()+e},e.prototype._isEmulateData=function(e){var r=this;if(t.requireParam(e,"path"),"undefined"!=typeof localStorage){var n=t.sanitizePath(e);return null!=localStorage.getItem(r._localStorageKey(n))}return!1},e.prototype._getEmulateData=function(e){var r=this;t.requireParam(e,"path");var n={};if("undefined"!=typeof localStorage){var i=t.sanitizePath(e);n=JSON.parse(localStorage.getItem(r._localStorageKey(i))||"{}")}else console&&console.error&&console.error("Missing local storage!");return n},e.prototype._deleteEmulateData=function(e){var r=this;if(t.requireParam(e,"path"),"undefined"!=typeof localStorage){var n=t.sanitizePath(e);localStorage.removeItem(r._localStorageKey(n))}else console&&console.error&&console.error("Missing local storage!")},e.prototype._setEmulateData=function(e,r){var n=this;if(t.requireParam(e,"path"),"undefined"!=typeof localStorage){var i=t.sanitizePath(e);localStorage.setItem(n._localStorageKey(i),JSON.stringify(r))}else console&&console.error&&console.error("Missing local storage!")},e.prototype._getChildren=function(e){var r,n,i,a=this,o=[];if("undefined"!=typeof localStorage){var s=t.sanitizePath(e);for(r in localStorage)r.indexOf(a._localStorageKey(s))||(n=r.substr(a._localStorageKey(s).length),i=n.substr(0,-1==n.indexOf("/")?n.length:n.indexOf("/")),i&&-1==o.indexOf(i)&&o.push(i))}else console&&console.error&&console.error("Missing local storage!");return o},e.prototype._getTypedChildren=function(e){var r,n=this._getChildren(e),i=[],a=t.sanitizePath(e+"/");for(r=0;n.length>r;r++)i.push({name:n[r],type:this._getChildren(a+n[r]+"/").length?"directory":"file"});return i},e.prototype.getMetadata=t.addCallbacks(function(e){var r=this;return t.requireParam(e,"path"),r.requireConfig("apiKey"),r.listChildren(e).then(function(n){return r.getNodeType(e).then(function(i){var a={};if(t.acontains(i,"directory")&&(a.defaultFiles={"text/x-quirrel-script":"index.qrl","text/html":"index.html"},a.children=n),t.acontains(i,"file"))if(r._isEmulateData(e)){var o=r._getEmulateData(e);a.type=o.type}else a.type="application/json";return a})})}),e.prototype.getNodeType=t.addCallbacks(function(e){var r=this;t.requireParam(e,"path"),r.requireConfig("apiKey");var n=t.sanitizePath(e),i=function(e){return r.execute({query:'count(load("'+e+'"))'}).then(function(e){return e.data&&e.data[0]||0})},a=function(e){return r._retrieveMetadata(e).then(function(e){return e.children})};return a(n).then(function(e){return i(n).then(function(t){var i=[];return e.length>0&&i.push("directory"),(t>0||r._isEmulateData(n))&&i.push("file"),i})})}),e.prototype.listChildren=t.addCallbacks(function(e){var r=this;t.requireParam(e,"path");var n=r._getTypedChildren(e);return this._retrieveMetadata(e).then(function(i){var a=i.children||[];return Vow.all(t.amap(a,function(t){return r.getNodeType(e+"/"+t)})).then(function(e){var r,i,o=[],s=[];for(r=0;a.length>r;r++){i=t.removeTrailingSlash(a[r]),s.push(i);for(var u=e[r],c=0;u.length>c;c++){var l=u[c];o.push({type:l,name:i})}}for(r=0;n.length>r;r++)i=t.removeTrailingSlash(n[r].name),-1==s.indexOf(i)&&o.push({name:i,type:n[r].type});return o})})}),e.prototype.listDescendants=t.addCallbacks(function(e){function r(e,i){return n.listChildren(e).then(function(n){var a=t.amap(n,function(r){return("/"===r.name||""===r.name)&&t.error("Infinite recursion"),t.sanitizePath(e+"/"+r.name)}),o=[];t.amap(a,function(e){t.acontains(o,e)||o.push(e)});var s=t.amap(o,function(e){return e.substr(i.length)}),u=t.amap(o,function(e){return r(e,i)});return Vow.all(u).then(function(e){return[].concat.apply(s,e)})})}var n=this;t.requireParam(e,"path");var i=t.sanitizePath(e+"/");return r(i,i)}),e.prototype.existsFile=t.addCallbacks(function(e){var r=this;t.requireParam(e,"path");var n=t.parentPath(e),i=t.lastPathElement(e);return""===i&&t.error("To determine if a file exists, the file name must be specified"),r.listChildren(n).then(function(e){var r=t.amap(e,function(e){return e.name});return t.acontains(r,i)})}),e.prototype.uploadFile=t.addCallbacks(function(r){var n,i=this;t.requireField(r,"path"),t.requireField(r,"type"),t.requireField(r,"contents"),i.requireConfig("apiKey"),"string"!=typeof r.contents&&t.error("File contents must be a string");var a=t.parentPath(r.path),o=t.lastPathElement(r.path);""===o&&t.error("A file may only be uploaded to a specific directory");var s,u=a+"/"+o;switch(r.type){case e.FileTypes.JSON:case e.FileTypes.JSON_STREAM:case e.FileTypes.CSV:case e.FileTypes.ZIP:case e.FileTypes.GZIP:s=!1;break;default:s=!0}if(s){var c=i._getEmulateData(u);return c.type=r.type,c.contents=r.contents,c.version=c.version?c.version+1:1,c.lastModified=(new Date).getTime(),i._setEmulateData(u,c),"text/x-quirrel-script"===r.type?i.executeFile({path:u}).then(function(e){return i.uploadFile({path:u,type:"application/json",contents:JSON.stringify(e.data),saveEmulation:!0})}).then(function(){return{versions:{head:c.version}}}):(n=Vow.promise(),n.fulfill({versions:{head:c.version}}),n)}var l=function(){return PrecogHttp.post({url:i.dataUrl((r.async?"async":"sync")+"/fs/"+u),content:r.contents,query:{apiKey:i.config.apiKey,ownerAccountId:r.ownerAccountId,delimiter:r.delimiter,quote:r.quote,escape:r.escape},headers:{"Content-Type":r.type},success:t.extractContent})};return PrecogHttp.delete0({url:i.dataUrl("async/fs/"+u),query:{apiKey:i.config.apiKey},success:t.extractContent}).then(l,l)
}),e.prototype.createFile=t.addCallbacks(function(e){var r=this;return t.requireField(e,"path"),t.requireField(e,"type"),t.requireFiled(e,"contents"),r.existsFile(e.path).then(function(n){return n?(t.error("The file "+e.path+" already exists"),void 0):r.uploadFile(e)})}),e.prototype.getFile=t.addCallbacks(function(e){var r=this;if(t.requireParam(e,"path"),r._isEmulateData(e)){var n=r._getEmulateData(e),i=Vow.promise();return i.fulfill({contents:n.contents,type:n.type}),i}return r.execute({query:'load("'+e+'")'}).then(function(e){return{contents:JSON.stringify(e.data),type:"application/json"}})}),e.prototype.append=t.addCallbacks(function(e){return e.values=[e.value],delete e.value,this.appendAll(e)}),e.prototype.appendAll=t.addCallbacks(function(e){var r=this;t.requireField(e,"values"),t.requireField(e,"path"),r.requireConfig("apiKey");var n=t.parentPath(e.path),i=t.lastPathElement(e.path);""===i&&t.error("Data must be appended to a specific file.");var a=n+"/"+i;return PrecogHttp.post({url:r.dataUrl(e.async?"async":"sync")+"/fs/"+a,content:e.values,query:{apiKey:r.config.apiKey,ownerAccountId:e.ownerAccountId},success:t.extractContent})}),e.prototype.delete0=t.addCallbacks(function(e){var r=this;return t.requireParam(e,"path"),r.requireConfig("apiKey"),r._deleteEmulateData(e),PrecogHttp.delete0({url:r.dataUrl("async/fs/"+e),query:{apiKey:r.config.apiKey},success:t.extractContent})}),e.prototype.deleteAll=t.addCallbacks(function(e){var r=this;t.requireParam(e,"path"),r.requireConfig("apiKey");var n=t.sanitizePath(e);return r.listDescendants(n).then(function(e){var i=t.amap(e,function(e){return t.sanitizePath(n+"/"+e)}).concat([n]);return Vow.all(t.amap(i,function(e){return r.delete0(e)}))})}),e.prototype.copyFile=t.addCallbacks(function(e){var r=this;return t.requireField(e,"source"),t.requireField(e,"dest"),r.getFile(e.source).then(function(t){return r.uploadFile({path:e.dest,type:t.type,contents:t.contents})})}),e.prototype.moveFile=t.addCallbacks(function(e){var r=this;return t.requireField(e,"source"),t.requireField(e,"dest"),r.copyFile(e).then(function(){return r.delete0(e.source)})}),e.prototype.moveDirectory=t.addCallbacks(function(e){var r=this;return t.requireField(e,"source"),t.requireField(e,"dest"),r.listDescendants(e.source).then(function(t){for(var n=[],i=0;t.length>i;i++){var a=e.source+"/"+t[i],o=e.dest+"/"+t[i];n.push(r.copyFile({source:a,dest:o}))}return Vow.all(n).then(function(){return r.deleteAll(e.source)})})}),e.prototype.executeFile=t.addCallbacks(function(e){var r=this;if(t.requireField(e,"path"),r._isEmulateData(e.path)&&e.maxAge){var n=r._getEmulateData(e.path);if(n.cached){var i=n.cached,a=(new Date).getTime()/1e3,o=a-i.timestamp;if(e.maxAge>o||e.maxStale&&e.maxAge+e.maxStale>o){var s=Vow.promise();return s.fulfill(i.results),s}}}return r.getFile(e.path).then(function(n){var i=t.parentPath(e.path);if("text/x-quirrel-script"===n.type){var a=t.sanitizePath("/"+i+"/"),o=a.split("/").join("//"),s=n.contents.split("/./").join(o).split('"./').join('"'+a),u={query:s};return r.execute(u).then(function(t){if("undefined"!=typeof localStorage&&t&&(null==t.errors||0===t.errors.length)){var n=r._getEmulateData(e.path);n.cached={results:t,timestamp:(new Date).getTime()/1e3},r._setEmulateData(e.path,n)}return t})}t.error("The file "+e.path+" does not have type text/x-quirrel-script and therefore cannot be executed")})}),e.prototype.execute=t.addCallbacks(function(e){var r=this;return t.requireField(e,"query"),r.requireConfig("apiKey"),PrecogHttp.get({url:r.analysisUrl("fs/"+(e.path||"")),query:{apiKey:r.config.apiKey,q:e.query,limit:e.limit,skip:e.skip,sortOn:e.sortOn,format:"detailed"},success:t.extractContent})}),e.prototype._asyncQuery=t.addCallbacks(function(e){var r=this;return t.requireField(e,"query"),PrecogHttp.post({url:r.analysisUrl("queries"),query:{apiKey:r.config.apiKey,q:e.query,limit:e.limit,basePath:e.path,skip:e.skip,order:e.order,sortOn:e.sortOn,sortOrder:e.sortOrder,timeout:e.timeout,prefixPath:e.prefixPath,format:e.format},success:t.extractContent})}),e.prototype._asyncQueryResults=t.addCallbacks(function(e){var r=this;return t.requireParam(e,"jobId"),PrecogHttp.get({url:r.analysisUrl("queries/")+e,query:{apiKey:r.config.apiKey},success:t.extractContent})})}(Precog),{http:PrecogHttp,api:Precog}});